#!/usr/bin/env tsx

/**
 * Script para executar seed com dados reais do Jo√£o Moura
 * 
 * Uso:
 * npx tsx run-seed-real-data.ts
 */

import dotenv from 'dotenv';
import { db, testConnection } from './server/db-local';
import { hashPassword } from './server/auth';
import * as schema from "./shared/schema";

// Carregar vari√°veis de ambiente
dotenv.config();

console.log('üöÄ Iniciando seed com dados reais...');
console.log(`üìß Contato: joaomoura.gta49@gmail.com`);
console.log(`üì± Telefone: (62) 99888-7766`);
console.log('');

if (!process.env.DATABASE_URL) {
  console.error('‚ùå DATABASE_URL n√£o configurado no arquivo .env');
  process.exit(1);
}

async function runRealDataSeed() {
  // Testar conex√£o primeiro
  console.log("üîå Testando conex√£o com o banco...");
  const connectionOk = await testConnection();
  if (!connectionOk) {
    throw new Error("Falha na conex√£o com o banco de dados");
  }
  
  try {
    // Limpar dados existentes
    console.log("üßπ Limpando dados existentes...");
    await db.delete(schema.messages);
    await db.delete(schema.contacts);
    await db.delete(schema.orders);
    await db.delete(schema.testimonials);
    await db.delete(schema.services);
    await db.delete(schema.projects);
    await db.delete(schema.paymentMethods);
    await db.delete(schema.siteSettings);
    await db.delete(schema.users);
    console.log("  ‚úÖ Dados limpos");

    // Inserir usu√°rios com dados reais
    console.log("üë• Inserindo usu√°rios com dados reais...");
    
    // Admin principal - Jo√£o Moura
    const adminPassword = await hashPassword("admin123");
    await db.insert(schema.users).values({
      name: "Jo√£o Moura",
      email: "joaomoura.gta49@gmail.com",
      username: "admin",
      password: adminPassword,
      role: "admin",
      avatar: null,
      createdAt: new Date()
    });
    console.log("  ‚úÖ Admin Jo√£o Moura criado");

    // Clientes reais do sistema automotivo
    const clientPasswords = [
      { name: "Roberto da Silva Santos", email: "roberto.santos@oficina.com", username: "roberto", password: await hashPassword("roberto123") },
      { name: "Anderson Luiz Ferreira", email: "anderson.ferreira@oficina.com", username: "anderson", password: await hashPassword("anderson123") },
      { name: "Carlos Eduardo Silva", email: "carlos.silva@email.com", username: "carlos", password: await hashPassword("carlos123") },
      { name: "Maria Fernanda Santos", email: "maria.santos@email.com", username: "maria", password: await hashPassword("maria123") }
    ];

    for (const user of clientPasswords) {
      await db.insert(schema.users).values({
        name: user.name,
        email: user.email,
        username: user.username,
        password: user.password,
        role: "user",
        avatar: null,
        createdAt: new Date()
      });
      console.log(`  ‚úÖ Cliente ${user.name} criado`);
    }

    // Projetos reais do portf√≥lio
    console.log("üìÇ Inserindo projetos do portf√≥lio...");
    const realProjects = [
      {
        title: "Sistema OfiMotors - Gest√£o Automotiva",
        description: "Sistema completo de gest√£o para oficinas mec√¢nicas com controle de estoque, ordens de servi√ßo, clientes e fornecedores. Inclui relat√≥rios avan√ßados e dashboard em tempo real.",
        category: "Sistema Empresarial",
        technologies: ["React", "Node.js", "PostgreSQL", "TypeScript", "Express", "Chart.js"],
        image: "https://images.unsplash.com/photo-1486312338219-ce68e2c54347",
        featured: true,
        price: "12000.00",
        status: "completed"
      },
      {
        title: "Portal AutoPe√ßas Brasil",
        description: "E-commerce especializado em autope√ßas com cat√°logo completo, sistema de vendas online e integra√ß√£o com fornecedores. Gest√£o completa de estoque e vendas.",
        category: "E-commerce",
        technologies: ["Next.js", "Stripe", "PostgreSQL", "Tailwind CSS", "React Query"],
        image: "https://images.unsplash.com/photo-1558618666-fcd25c85cd64",
        featured: true,
        price: "8500.00",
        status: "active"
      },
      {
        title: "App Mec√¢nicos Mobile",
        description: "Aplicativo m√≥vel para mec√¢nicos com gest√£o de ordens de servi√ßo, comunica√ß√£o com clientes via chat e notifica√ß√µes push para status de servi√ßos.",
        category: "Mobile Development",
        technologies: ["React Native", "Firebase", "Node.js", "Socket.io"],
        image: "https://images.unsplash.com/photo-1512486130939-2c4f79935e4f",
        featured: false,
        price: "6500.00",
        status: "active"
      },
      {
        title: "Dashboard Analytics OfiMotors",
        description: "Dashboard com m√©tricas em tempo real para acompanhamento de vendas, servi√ßos executados, an√°lise de estoque e relat√≥rios gerenciais avan√ßados.",
        category: "Data Visualization",
        technologies: ["React", "D3.js", "Chart.js", "PostgreSQL", "Express"],
        image: "https://images.unsplash.com/photo-1551288049-bebda4e38f71",
        featured: false,
        price: "4200.00",
        status: "completed"
      }
    ];

    for (const project of realProjects) {
      await db.insert(schema.projects).values({
        title: project.title,
        description: project.description,
        category: project.category,
        technologies: project.technologies,
        image: project.image,
        featured: project.featured,
        price: project.price,
        status: project.status,
        createdAt: new Date()
      });
      console.log(`  ‚úÖ Projeto ${project.title} inserido`);
    }

    // Servi√ßos especializados
    console.log("üõ†Ô∏è Inserindo servi√ßos especializados...");
    const realServices = [
      {
        title: "Desenvolvimento de Sistemas Empresariais",
        description: "Desenvolvimento completo de sistemas de gest√£o empresarial personalizados para o setor automotivo e industrial",
        category: "Desenvolvimento",
        price: "180.00",
        duration: "50 horas",
        features: ["Gest√£o completa", "Relat√≥rios avan√ßados", "API integra√ß√£o", "Dashboard analytics"]
      },
      {
        title: "E-commerce Automotivo",
        description: "Desenvolvimento de plataformas e-commerce especializadas no setor automotivo com cat√°logo de pe√ßas e gest√£o de vendas",
        category: "E-commerce",
        price: "220.00",
        duration: "60 horas",
        features: ["Cat√°logo de pe√ßas", "Sistema de vendas", "Gest√£o de estoque", "Integra√ß√£o pagamentos"]
      },
      {
        title: "Aplicativos Mobile para Oficinas",
        description: "Desenvolvimento de apps m√≥veis para gest√£o de oficinas mec√¢nicas e comunica√ß√£o com clientes",
        category: "Mobile",
        price: "160.00",
        duration: "45 horas",
        features: ["App nativo", "Notifica√ß√µes push", "Chat em tempo real", "Geolocaliza√ß√£o"]
      },
      {
        title: "Consultoria em Sistemas Automotivos",
        description: "Consultoria especializada em digitaliza√ß√£o e automa√ß√£o de processos no setor automotivo",
        category: "Consultoria",
        price: "250.00",
        duration: "Por hora",
        features: ["An√°lise de processos", "Automa√ß√£o", "Integra√ß√£o sistemas", "Treinamento equipe"]
      }
    ];

    for (const service of realServices) {
      await db.insert(schema.services).values({
        title: service.title,
        description: service.description,
        category: service.category,
        price: service.price,
        duration: service.duration,
        features: service.features,
        createdAt: new Date()
      });
      console.log(`  ‚úÖ Servi√ßo ${service.title} inserido`);
    }

    // Depoimentos reais de clientes
    console.log("üí¨ Inserindo depoimentos de clientes...");
    const realTestimonials = [
      {
        name: "Roberto da Silva Santos",
        company: "AutoPe√ßas Brasil Ltda",
        content: "O Jo√£o desenvolveu um sistema completo de gest√£o que revolucionou nossa empresa. Controle total do estoque, vendas em tempo real e relat√≥rios que nos ajudam nas decis√µes estrat√©gicas. Profissional excepcional!",
        rating: 5,
        image: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e"
      },
      {
        name: "Anderson Luiz Ferreira",
        company: "Oficina Mec√¢nica Express",
        content: "Trabalho impec√°vel! O app m√≥vel desenvolvido facilitou muito nosso atendimento aos clientes. Agora conseguimos dar updates em tempo real sobre os servi√ßos. Recomendo de olhos fechados!",
        rating: 5,
        image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d"
      },
      {
        name: "Carlos Eduardo Silva",
        company: "Distribuidora Motores S/A",
        content: "Sistema robusto e confi√°vel. O dashboard de analytics desenvolvido pelo Jo√£o nos d√° uma vis√£o completa do neg√≥cio. Conseguimos identificar tend√™ncias e otimizar nossos processos.",
        rating: 5,
        image: "https://images.unsplash.com/photo-1519244703995-f4e0f30006d5"
      },
      {
        name: "Maria Fernanda Santos",
        company: "Freios & Suspens√£o Sul",
        content: "A consultoria do Jo√£o foi fundamental para digitalizarmos nossos processos. Automatizamos tarefas manuais e aumentamos nossa produtividade em 40%. Investimento que se pagou rapidamente!",
        rating: 5,
        image: "https://images.unsplash.com/photo-1494790108755-2616b2f6c4e5"
      }
    ];

    for (const testimonial of realTestimonials) {
      await db.insert(schema.testimonials).values({
        name: testimonial.name,
        company: testimonial.company,
        message: testimonial.content,
        rating: testimonial.rating,
        avatar: testimonial.image,
        createdAt: new Date()
      });
      console.log(`  ‚úÖ Depoimento de ${testimonial.name} inserido`);
    }

    // Configura√ß√µes do site
    console.log("‚öôÔ∏è Inserindo configura√ß√µes do site...");
    await db.insert(schema.siteSettings).values({
      siteName: "Jo√£o Moura Dev",
      siteTitle: "Jo√£o Moura - Desenvolvimento de Sistemas Empresariais",
      contactEmail: "joaomoura.gta49@gmail.com",
      contactPhone: "(62) 99888-7766",
      address: "Goi√¢nia, GO",
      github: "https://github.com/joaomoura",
      linkedin: "https://linkedin.com/in/joaomoura-dev",
      twitter: "https://twitter.com/joaomoura_dev",
      instagram: "https://instagram.com/joaomoura.dev",
      whatsapp: "5562998887766",
      updatedAt: new Date()
    });
    console.log("  ‚úÖ Configura√ß√µes inseridas");

    // M√©todos de pagamento
    console.log("üí≥ Inserindo m√©todos de pagamento...");
    const paymentMethods = [
      {
        provider: "stripe",
        name: "Cart√£o de Cr√©dito/D√©bito",
        enabled: true,
        currency: "BRL",
        config: JSON.stringify({
          publicKey: "pk_test_joaomoura",
          currency: "BRL",
          acceptedCards: ["visa", "mastercard", "elo"]
        })
      },
      {
        provider: "pix",
        name: "PIX",
        enabled: true,
        currency: "BRL",
        config: JSON.stringify({
          pixKey: "joaomoura.gta49@gmail.com",
          bankName: "Banco Inter",
          pixType: "email"
        })
      },
      {
        provider: "bank_transfer",
        name: "Transfer√™ncia Banc√°ria",
        enabled: true,
        currency: "BRL",
        config: JSON.stringify({
          bankName: "Banco Inter",
          agency: "0001",
          account: "123456-7",
          accountType: "corrente"
        })
      }
    ];

    for (const method of paymentMethods) {
      await db.insert(schema.paymentMethods).values({
        ...method,
        createdAt: new Date(),
        updatedAt: new Date()
      });
      console.log(`  ‚úÖ M√©todo ${method.name} inserido`);
    }

    console.log("\nüéâ Seed com dados reais conclu√≠do com sucesso!");
    console.log("\nüìä Dados inseridos:");
    console.log("  üë• 5 usu√°rios (1 admin + 4 clientes)");
    console.log("  üìÇ 4 projetos do portf√≥lio");
    console.log("  üõ†Ô∏è 4 servi√ßos especializados");
    console.log("  üí¨ 4 depoimentos de clientes");
    console.log("  ‚öôÔ∏è Configura√ß√µes do site");
    console.log("  üí≥ 3 m√©todos de pagamento");
    
    console.log("\nüîë Credenciais de acesso:");
    console.log("  Admin: admin / admin123");
    console.log("  Cliente: roberto / roberto123");
    console.log("  Cliente: anderson / anderson123");
    console.log("  Cliente: carlos / carlos123");

    console.log("\nüöÄ Para iniciar o projeto:");
    console.log("  npm run dev");
    console.log("  Acesse: http://localhost:5000");

  } catch (error) {
    console.error("\n‚ùå Erro no seed:", error.message);
    throw error;
  }
}

// Executar seed
runRealDataSeed()
  .then(() => {
    console.log("\n‚úÖ Processo conclu√≠do!");
    process.exit(0);
  })
  .catch((error) => {
    console.error("\nüí• Falha no seed:", error);
    process.exit(1);
  });